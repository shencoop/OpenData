<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ç«‹æ³•é™¢ IVOD å½±ç‰‡æ“·å–å·¥å…·</title>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    background: #f8f9fa;
    padding: 2rem;
    max-width: 700px;
    margin: auto;
  }
  h2 {
    color: #0d6efd;
  }
  input, button {
    width: 100%;
    padding: 0.75rem;
    margin-bottom: 1rem;
    font-size: 1rem;
    border-radius: 8px;
    border: 1px solid #ccc;
  }
  button {
    background: #0d6efd;
    color: white;
    border: none;
    cursor: pointer;
  }
  button:hover {
    background: #0b5ed7;
  }
  pre {
    background: #f1f3f5;
    padding: 1rem;
    border-radius: 8px;
    white-space: pre-wrap;
    word-break: break-all;
  }
  .actions {
    display: flex;
    gap: 0.5rem;
  }
  .actions button {
    flex: 1;
  }
</style>
</head>
<body>
  <h2>ğŸ¥ ç«‹æ³•é™¢ IVOD å½±ç‰‡æ“·å–å·¥å…·</h2>
  <p>è²¼ä¸Š <code>ivod.ly.gov.tw</code> çš„å½±ç‰‡ç¶²å€ï¼Œæ“·å–å°æ‡‰çš„ <code>.m3u8</code> ä¸²æµé€£çµèˆ‡ <code>ffmpeg</code> ä¸‹è¼‰æŒ‡ä»¤ï¼Œä¸¦å¯è½‰æ›ç‚º <code>.mp3</code> éŒ„éŸ³æ ¼å¼æ–¹ä¾¿é€²è¡Œé€å­—ç¨¿ã€‚</p>
  <input id="url" type="text" placeholder="ä¾‹å¦‚ï¼šhttps://ivod.ly.gov.tw/Play/Clip/1M/163842" />
  <div class="actions">
    <button onclick="extract()">æ“·å–å½±ç‰‡é€£çµ</button>
    <button onclick="clearOutput()">æ¸…é™¤çµæœ</button>
  </div>
  <pre id="output">ç­‰å¾…è¼¸å…¥ç¶²å€...</pre>
  <div class="actions" id="extraButtons" style="display:none">
    <button onclick="copyLink()">ğŸ“‹ è¤‡è£½ m3u8 é€£çµ</button>
    <button onclick="copyCommand()">ğŸ’» è¤‡è£½ ffmpeg æŒ‡ä»¤</button>
    <button onclick="downloadVideo()">â¬‡ï¸ ä¸‹è¼‰å½±ç‰‡</button>
    <button onclick="copyAudioCommand()">ğŸ§ è½‰æ›ç‚º MP3</button>
  </div>

  <script>
    let currentM3u8 = '';
    let currentCmd = '';
    let currentAudioCmd = '';

    async function extract() {
      const url = document.getElementById('url').value.trim();
      const output = document.getElementById('output');
      const extraButtons = document.getElementById('extraButtons');
      if (!url) {
        output.textContent = 'âš ï¸ è«‹å…ˆè¼¸å…¥ç¶²å€';
        return;
      }
      output.textContent = 'â³ æ­£åœ¨æ“·å–ä¸­ï¼Œè«‹ç¨å€™...';
      extraButtons.style.display = 'none';
      try {
        const proxyCandidates = [
          `https://thingproxy.freeboard.io/fetch/${url}`,
          `https://cors.isomorphic-git.org/${url}`,
          `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`
        ];
        const resp = await fetch(proxyUrl);
        const data = await resp.json();
        const match = data.contents.match(/https[^\"']+\.m3u8/g);
        if (match && match.length > 0) {
          currentM3u8 = match[0];
          currentCmd = `ffmpeg -i \"${currentM3u8}\" -c copy output.mp4`;
          currentAudioCmd = `ffmpeg -i \"${currentM3u8}\" -vn -acodec libmp3lame -ab 192k output.mp3`;
          output.textContent = `âœ… æ‰¾åˆ°å½±ç‰‡ä¸²æµï¼š\n${currentM3u8}\n\nğŸ’» å½±ç‰‡ä¸‹è¼‰æŒ‡ä»¤ï¼š\n${currentCmd}\n\nğŸ§ éŸ³è¨Šè½‰æª”æŒ‡ä»¤ï¼š\n${currentAudioCmd}`;
          extraButtons.style.display = 'flex';
        } else {
          output.textContent = 'âŒ æœªæ‰¾åˆ° .m3u8 ä¸²æµé€£çµï¼Œå¯èƒ½è©²é å½±ç‰‡æœªé–‹æ”¾æˆ–æ ¼å¼ä¸åŒã€‚';
        }
      } catch (err) {
        output.textContent = 'âŒ æ“·å–æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š' + err.message;
      }
    }

    function copyLink() {
      if (currentM3u8) navigator.clipboard.writeText(currentM3u8);
      alert('âœ… å·²è¤‡è£½ m3u8 é€£çµ');
    }

    function copyCommand() {
      if (currentCmd) navigator.clipboard.writeText(currentCmd);
      alert('âœ… å·²è¤‡è£½ ffmpeg æŒ‡ä»¤');
    }

    function copyAudioCommand() {
      if (currentAudioCmd) navigator.clipboard.writeText(currentAudioCmd);
      alert('âœ… å·²è¤‡è£½è½‰ MP3 æŒ‡ä»¤');
    }

    function downloadVideo() {
      if (currentM3u8) window.open(currentM3u8, '_blank');
    }

    function clearOutput() {
      document.getElementById('output').textContent = 'ç­‰å¾…è¼¸å…¥ç¶²å€...';
      document.getElementById('extraButtons').style.display = 'none';
      currentM3u8 = '';
      currentCmd = '';
      currentAudioCmd = '';
    }
  </script>
</body>
</html>
