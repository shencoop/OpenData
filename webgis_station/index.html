
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>WebGIS Station Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <style>
    #map { height: 90vh; }
    .controls { margin: 10px; }
  </style>
</head>
<body>
  <div class="controls">
    <label for="typeFilter">類型 (type):</label>
    <select id="typeFilter">
      <option value="all">全部</option>
    </select>

    <label for="adminFilter">縣市 (AdminName):</label>
    <select id="adminFilter">
      <option value="all">全部</option>
    </select>
  </div>

  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script>
    let geojsonData;
    fetch('stations.geojson')
      .then(response => response.json())
      .then(data => {
        geojsonData = data;
        initMap();
      });

    function initMap() {
      const map = L.map('map').setView([23.7, 121], 8);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 18,
        attribution: 'OpenStreetMap contributors'
      }).addTo(map);

      const typeSet = new Set();
      const adminSet = new Set();

      const markerLayer = L.geoJSON(geojsonData, {
        onEachFeature: function (feature, layer) {
          const props = feature.properties;
          layer.bindPopup(`<b>${props.Name}</b><br>Station ID: ${props.StationId}<br>Type: ${props.type}<br>Admin: ${props.AdminName}`);
          layer.featureType = props.type;
          layer.featureAdmin = props.AdminName;
        }
      });

      markerLayer.eachLayer(layer => {
        typeSet.add(layer.featureType);
        adminSet.add(layer.featureAdmin);
      });

      markerLayer.addTo(map);

      const typeFilter = document.getElementById('typeFilter');
      const adminFilter = document.getElementById('adminFilter');

      typeSet.forEach(type => {
        const opt = document.createElement('option');
        opt.value = type;
        opt.textContent = type;
        typeFilter.appendChild(opt);
      });

      adminSet.forEach(admin => {
        const opt = document.createElement('option');
        opt.value = admin;
        opt.textContent = admin;
        adminFilter.appendChild(opt);
      });

      function updateMap() {
        const selectedType = typeFilter.value;
        const selectedAdmin = adminFilter.value;
        markerLayer.clearLayers();
        L.geoJSON(geojsonData, {
          filter: function (feature) {
            return (selectedType === 'all' || feature.properties.type === selectedType) &&
                   (selectedAdmin === 'all' || feature.properties.AdminName === selectedAdmin);
          },
          onEachFeature: function (feature, layer) {
            const props = feature.properties;
            layer.bindPopup(`<b>${props.Name}</b><br>Station ID: ${props.StationId}<br>Type: ${props.type}<br>Admin: ${props.AdminName}`);
          }
        }).addTo(map);
      }

      typeFilter.addEventListener('change', updateMap);
      adminFilter.addEventListener('change', updateMap);
    }
  </script>
</body>
</html>
